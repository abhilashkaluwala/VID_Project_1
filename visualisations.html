<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Education vs Economic Outcomes</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"> <!-- Roboto Font -->
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif; /* Use Roboto, fallback to Arial */
            margin: 0; /* Remove default body margin */
            background-color: #f5f5f5; /* Light gray background */
            color: #333; /* Dark gray text */
            text-align: center; /* Center align text */
        }

        .header {
            background-color: #2196f3; /* Material Blue */
            color: white;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Subtle shadow */
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em; /* Larger heading */
            font-weight: 500;
        }

        .header p {
            margin: 10px 0 0 0; /* Some top margin for the paragraph */
            font-size: 1.1em; /* Slightly larger font size */
            line-height: 1.5;
        }
        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Vertically align items */
            padding: 10px;
        }

        .chart-container {
            display: flex;
            justify-content: space-around; /* Distribute space around charts */
            flex-wrap: wrap; /* Allow wrapping to next line on smaller screens */
            padding: 0 20px; /* Add some padding on the sides */
        }

        .chart {
            margin: 20px;
            background-color: white; /* White background for charts */
            border-radius: 8px; /* Rounded corners */
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); /* Subtle shadow */
            padding: 15px;
            box-sizing: border-box; /* Include padding in width/height */
            text-align: left; /* Align text to the left within the charts*/
        }
        .chart svg {
            width: 100%;
        }
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: #555;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
      .map-box {
            border: 2px solid #ddd; /* Lighter border */
            border-radius: 8px; /* Consistent rounded corners */
            padding: 10px;
            position: relative;
            width: 980px;
            height: 620px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); /* Consistent shadow */
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .legend-container {
            font-size: 12px;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            width: 320px;

        }

        .legend-svg {
            width: 300px;
            height: 40px;
        }
        .tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.95); /* Slightly transparent white */
            padding: 8px;
            border-radius: 5px;
            box-shadow: 0px 0px 5px rgba(0,0,0,0.3);
            font-size: 12px;
            visibility: hidden;
            border: 1px solid #ddd; /* Light border */
            pointer-events: none; /* Important: Prevents tooltip from interfering with mouse events */
            z-index: 10; /* Ensure tooltip is on top */
        }

        .toggle-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;  /* Vertically center items */
            justify-content: center; /* Horizontally center items */
        }

        .toggle-container label {
             margin-right: 10px; /* Spacing between label and select */
             font-weight: 500;  /* Medium font weight for labels */
         }

         .toggle-container select {
             padding: 8px 12px;  /* Comfortable padding */
             border: 1px solid #ccc;  /* Light border */
             border-radius: 4px;  /* Slightly rounded corners */
             font-size: 16px;
             background-color: white;
             cursor: pointer;
             appearance: none;  /* Remove default styling */
             -webkit-appearance: none;
             -moz-appearance: none;
             background-image: url("data:image/svg+xml;utf8,<svg fill='black' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>"); /* Custom dropdown arrow */
             background-repeat: no-repeat;
             background-position-x: 95%;  /* Position the arrow */
             background-position-y: 50%;
        }
        .map-title {
            margin-bottom: .5rem;
            font-size: 1.25rem;
            font-weight: bold;
        }
        .legend-title {
            margin-bottom: .25rem;
            font-weight: 500;
        }

    </style>
</head>
<body>
    <div class="header">
        <h1>Education vs Economic Outcomes</h1>
         <div class="header-info">
            <div><strong>Name:</strong> Abhilash</div>
            <div><strong>Project Name:</strong> Education vs Economic Outcomes</div>
            <div><strong>Framework used:</strong> D3.js</div>
        </div>
        <p>
            This interactive visualization explores the relationship between education levels and economic indicators across US counties.  The maps allow you to compare different measures of education (high school diploma, some college, bachelor's degree) with various economic factors (median household income, poverty rate, per capita income).  Histograms provide a distribution of the selected variables, and the scatter plot shows the correlation between bachelor's degree attainment and median household income.  Explore the data to uncover insights into the impact of education on economic well-being.
        </p>

    </div>


    <div class="container">
        <!-- Education Map Section -->
        <div class="map-section">
            <div class="toggle-container">
                <label for="educationToggle">Select Education Level:</label>
                <select id="educationToggle">
                    <option value="Ed2HSDiplomaOnlyPct">High School Diploma (%)</option>
                    <option value="Ed3SomeCollegePct">Some College (%)</option>
                    <option value="Ed5CollegePlusPct">Bachelor's & Higher (%)</option>
                </select>
            </div>
            <div class="map-box">
              <h3 class="map-title">Education Level by County</h3>
                <div class="map-container">
                    <svg id="educationMap" width="960" height="600"></svg>
                </div>
            </div>
            <div class="legend-container">
                <strong class="legend-title" id="educationLegendTitle"></strong>
                <svg class="legend-svg" id="educationLegend"></svg>
            </div>
        </div>


        <!-- Economic Map Section -->
       <div class="map-section">
            <div class="toggle-container">
                <label for="economicToggle">Select Economic Indicator:</label>
                <select id="economicToggle">
                    <option value="Median_HH_Inc_ACS">Median Household Income ($)</option>
                    <option value="Poverty_Rate_ACS">Poverty Rate (%)</option>
                    <option value="PerCapitaInc">Per Capita Income ($)</option>
                </select>
            </div>

            <div class="map-box">
                <h3 class="map-title">Economic Indicator by County</h3>
                <div class="map-container">
                    <svg id="economicMap" width="960" height="600"></svg>
                </div>
             </div>


            <div class="legend-container">
                 <strong class="legend-title" id="economicLegendTitle"></strong>
                <svg class="legend-svg" id="economicLegend"></svg>
            </div>
        </div>

    </div>

    <div class="tooltip" id="tooltip"></div>

    <div class="chart-container">
        <div id="histogramEducation" class="chart">
            <h3>Education Distribution</h3>
        </div>
        <div id="histogramIncome" class="chart">
          <h3>Income Distribution</h3>
        </div>
    </div>
    
    <div id="scatterplot" class="chart">
        <h3>Bachelor's Degree vs. Median Household Income</h3>
    </div>

    <script>
        d3.csv("data.csv").then(function(data) {
            data.forEach(d => {
                d.Ed5CollegePlusPct = +d.Ed5CollegePlusPct;
                d.Median_HH_Inc_ACS = +d.Median_HH_Inc_ACS;
            });

            createHistogram(data, "Ed5CollegePlusPct", "#histogramEducation", "% with Bachelor's Degree or Higher");
            createHistogram(data, "Median_HH_Inc_ACS", "#histogramIncome", "Median Household Income ($)");
            createScatterPlot(data);
        });

      function createHistogram(data, key, container, xlabel) {
          const margin = { top: 20, right: 30, bottom: 50, left: 50 },
                width = 400 - margin.left - margin.right,
                height = 300 - margin.top - margin.bottom;

          const svg = d3.select(container)
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform", `translate(${margin.left},${margin.top})`);

          const tooltip = d3.select("#tooltip"); // Use the existing tooltip

          const x = d3.scaleLinear()
              .domain(d3.extent(data, d => d[key]))
              .nice()
              .range([0, width]);

          const bins = d3.histogram()
              .domain(x.domain())
              .thresholds(x.ticks(20))
              (data.map(d => d[key]));

          const y = d3.scaleLinear()
              .domain([0, d3.max(bins, d => d.length)])
              .nice()
              .range([height, 0]);

          svg.append("g")
              .selectAll("rect")
              .data(bins)
              .enter().append("rect")
              .attr("x", d => x(d.x0))
              .attr("y", d => y(d.length))
              .attr("width", d => x(d.x1) - x(d.x0) - 1)
              .attr("height", d => height - y(d.length))
              .attr("fill", "steelblue")
              .on("mouseover", (event, d) => {
                  // Get all counties in this bin
                  let countiesInBin = data.filter(item => item[key] >= d.x0 && item[key] < d.x1)
                                          .map(item => `${item.County}, ${item.State}`); // County + State

                  let countyList = countiesInBin.length > 10
                      ? countiesInBin.slice(0, 10).join("<br>") + "<br>..."  // Show only first 10
                      : countiesInBin.join("<br>");

                  tooltip.style("visibility", "visible")
                      .html(`<strong>Range:</strong> ${d.x0.toFixed(1)} - ${d.x1.toFixed(1)}<br>
                             <strong>Count:</strong> ${d.length} counties<br>
                             <strong>Sample Counties:</strong><br>${countyList}`);
              })
              .on("mousemove", (event) => {
                    tooltip.style("top", (event.pageY - 10) + "px")
                        .style("left", (event.pageX + 10) + "px");
                })
              .on("mouseout", () => {
                  tooltip.style("visibility", "hidden");
              });

          svg.append("g")
              .attr("transform", `translate(0,${height})`)
              .call(d3.axisBottom(x));

          svg.append("g")
              .call(d3.axisLeft(y));

          svg.append("text")
              .attr("x", width / 2)
              .attr("y", height + 40)
              .attr("text-anchor", "middle")
              .attr("class", "axis-label")
              .text(xlabel);

          svg.append("text")
              .attr("x", -height / 2)
              .attr("y", -35)
              .attr("transform", "rotate(-90)")
              .attr("text-anchor", "middle")
              .attr("class", "axis-label")
              .text("Number of Counties");
      }



function createScatterPlot(data) {
    const margin = { top: 20, right: 30, bottom: 50, left: 50 },
          width = 500 - margin.left - margin.right,
          height = 400 - margin.top - margin.bottom;

    const svg = d3.select("#scatterplot")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    const tooltip = d3.select("#tooltip"); // Re-use the existing tooltip


    const x = d3.scaleLinear()
        .domain(d3.extent(data, d => d.Ed5CollegePlusPct))
        .nice()
        .range([0, width]);

    const y = d3.scaleLinear()
        .domain(d3.extent(data, d => d.Median_HH_Inc_ACS))
        .nice()
        .range([height, 0]);

    svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x));

    svg.append("g")
        .call(d3.axisLeft(y));

    svg.append("text")
        .attr("x", width / 2)
        .attr("y", height + 40)
        .attr("text-anchor", "middle")
        .attr("class", "axis-label")
        .text("% with Bachelor's Degree or Higher");

    svg.append("text")
        .attr("x", -height / 2)
        .attr("y", -35)
        .attr("transform", "rotate(-90)")
        .attr("text-anchor", "middle")
        .attr("class", "axis-label")
        .text("Median Household Income ($)");

    svg.selectAll("circle")
        .data(data)
        .enter().append("circle")
        .attr("cx", d => x(d.Ed5CollegePlusPct))
        .attr("cy", d => y(d.Median_HH_Inc_ACS))
        .attr("r", 3)
        .attr("fill", "steelblue")
        .attr("opacity", 0.7)
        .on("mouseover", (event, d) => {
            tooltip.style("visibility", "visible")
                .html(`<strong>${d.County}, ${d.State}</strong><br>
                       <strong>Bachelor's & Higher:</strong> ${d.Ed5CollegePlusPct}%<br>
                       <strong>Income:</strong> $${d.Median_HH_Inc_ACS.toLocaleString()}`);
        })
        .on("mousemove", (event) => {
              tooltip.style("top", (event.pageY - 10) + "px")
                  .style("left", (event.pageX + 10) + "px");
          })
        .on("mouseout", () => {
            tooltip.style("visibility", "hidden");
        });
}
        const educationCategories = {
            "Ed2HSDiplomaOnlyPct": "High School Diploma (%)",
            "Ed3SomeCollegePct": "Some College (%)",
            "Ed5CollegePlusPct": "Bachelor's & Higher (%)"
        };

        const economicCategories = {
            "Median_HH_Inc_ACS": "Median Household Income ($)",
            "Poverty_Rate_ACS": "Poverty Rate (%)",
            "PerCapitaInc": "Per Capita Income ($)"
        };

        const width = 960, height = 600;

        const educationColor = d3.scaleSequential(d3.interpolateBlues).domain([0, 100]);
        const economicColors = {
            "Median_HH_Inc_ACS": d3.scaleSequential(d3.interpolateGreens).domain([20000, 120000]),
            "Poverty_Rate_ACS": d3.scaleSequential(d3.interpolateReds).domain([0, 40]),
            "PerCapitaInc": d3.scaleSequential(d3.interpolatePurples).domain([15000, 80000])
        };

        function initializeZoom(mapId) {
            const svg = d3.select(mapId);
            const g = svg.append("g");
            const zoom = d3.zoom()
                .scaleExtent([1, 5])
                .on("zoom", (event) => {
                    g.attr("transform", event.transform);
                });

            svg.call(zoom);
            return g;
        }

        const educationSvg = initializeZoom("#educationMap");
        const economicSvg = initializeZoom("#economicMap");
        //const tooltip = d3.select("#tooltip"); //moved to the individual chart
        const projection = d3.geoAlbersUsa().scale(1300).translate([width / 2, height / 2]);
        const path = d3.geoPath().projection(projection);

        d3.json("us_counties.json").then(countyData => {
            d3.csv("data.csv").then(data => {

                let countyMap = {};
                data.forEach(d => {
                    let fipsCode = d.FIPS.padStart(5, '0');
                    countyMap[fipsCode] = {
                        County: d.County,
                        State: d.State,
                        Ed2HSDiplomaOnlyPct: +d.Ed2HSDiplomaOnlyPct || 0,
                        Ed3SomeCollegePct: +d.Ed3SomeCollegePct || 0,
                        Ed5CollegePlusPct: +d.Ed5CollegePlusPct || 0,
                        Median_HH_Inc_ACS: +d.Median_HH_Inc_ACS || 20000,
                        Poverty_Rate_ACS: +d.Poverty_Rate_ACS || 0,
                        PerCapitaInc: +d.PerCapitaInc || 15000
                    };
                });
              function drawMap(selectedCategory, g, colorScale, legendSvgId, legendTitleId, categoryLabels) {
                  g.selectAll("*").remove();
                  g.selectAll("path")
                      .data(topojson.feature(countyData, countyData.objects.counties).features)
                      .enter().append("path")
                      .attr("d", d => path(d) || "") // Handle null paths
                      .attr("fill", d => {
                          let county = countyMap[d.id];
                          if (county) {
                            return colorScale(county[selectedCategory])
                          } else {
                            console.warn("Missing data for county ID:", d.id);
                            return "#ccc"; // Consistent fallback color
                          }

                      })
                      .attr("stroke", "#999")
                      .on("mouseover", (event, d) => {
                          let county = countyMap[d.id];
                          let value = county ? county[selectedCategory] : "No Data";
                          const tooltip = d3.select("#tooltip");
                          tooltip.style("visibility", "visible")
                              .html(`<strong>${county ? county.County + ", " + county.State : "Unknown"}</strong><br>${categoryLabels[selectedCategory]}: ${value.toLocaleString()}`);
                      })
                      .on("mousemove", (event) => {
                            const tooltip = d3.select("#tooltip");
                            tooltip.style("top", (event.pageY - 10) + "px")
                                .style("left", (event.pageX + 10) + "px");
                        })
                      .on("mouseout", () => {
                        const tooltip = d3.select("#tooltip");
                          tooltip.style("visibility", "hidden");
                      });
              }


              function drawLegend(legendSvgId, legendTitleId, colorScale, min, max, label) {
                  d3.select(legendTitleId).text(label); // Update title text
                  const legendSvg = d3.select(legendSvgId);
                  legendSvg.selectAll("*").remove(); // Clear previous legend

                  const defs = legendSvg.append("defs");
                  const linearGradient = defs.append("linearGradient")
                      .attr("id", legendSvgId + "-gradient")
                      .attr("x1", "0%")
                      .attr("x2", "100%");

                  linearGradient.append("stop").attr("offset", "0%").attr("stop-color", colorScale(min));
                  linearGradient.append("stop").attr("offset", "100%").attr("stop-color", colorScale(max));

                  legendSvg.append("rect")
                      .attr("width", 300)
                      .attr("height", 15)
                      .attr("fill", `url(#${legendSvgId}-gradient)`);

                  legendSvg.append("text").attr("x", 0).attr("y", 30).text(min.toLocaleString());
                  legendSvg.append("text").attr("x", 270).attr("y", 30).text(max.toLocaleString());
              }


                function updateMaps() {
                    let selectedEducation = document.getElementById("educationToggle").value;
                    let selectedEconomic = document.getElementById("economicToggle").value;

                    drawMap(selectedEducation, educationSvg, educationColor, "#educationLegend", "#educationLegendTitle", educationCategories);
                    drawMap(selectedEconomic, economicSvg, economicColors[selectedEconomic], "#economicLegend", "#economicLegendTitle", economicCategories);

                    drawLegend("#educationLegend", "#educationLegendTitle", educationColor, 0, 100, educationCategories[selectedEducation]);
                    drawLegend("#economicLegend", "#economicLegendTitle", economicColors[selectedEconomic], economicColors[selectedEconomic].domain()[0], economicColors[selectedEconomic].domain()[1], economicCategories[selectedEconomic]);
                }


                document.getElementById("educationToggle").addEventListener("change", updateMaps);
                document.getElementById("economicToggle").addEventListener("change", updateMaps);

                updateMaps(); // Initial draw
            });
        });
    </script>
</body>
</html>
